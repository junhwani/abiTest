<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
  </head>
  <body>
    <ul>
      <li>컨트랙트주소 : <span id="contractAddr"></span> </li>
      <li>내 어카운트 주소 : <span id="accountAddr"></span> </li>
      <li>내 어카운트 잔액 : <span id="accountBalance"></span> </li>
      <li>토큰 주소 : <span id="tokenAddress"></span> </li>
      <li>토큰 잔액 : <span id="tokenBalance"></span> </li>
    </ul>

  </body>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
  <script type="text/javascript">
    var contractAddress = "0xd6F47022d4A19c5F7FD411804Ea46E627B90100F";
    var abi =
[{"constant":false,"inputs":[],"name":"checkGoalReached","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"withdrawalOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"transferableToken","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"deadline","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"fundingEth","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"fundingEthReached","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"currentSwapRate","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"fundersProperty","outputs":[{"name":"paymentEther","type":"uint256"},{"name":"reservedToken","type":"uint256"},{"name":"withdrawed","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"soldToken","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"isOpened","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"tokenReward","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"startTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"TokenPerEther","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"price","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getNow","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getEth","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"withdrawal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getRemainingTimeEthToken","outputs":[{"name":"min","type":"uint256"},{"name":"shortage","type":"uint256"},{"name":"remainToken","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_new","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getSoldToken","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_addressOfTokenUsedAsReward","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"fundingEth","type":"uint256"},{"indexed":false,"name":"deadline","type":"uint256"},{"indexed":false,"name":"transferableToken","type":"uint256"},{"indexed":false,"name":"beneficiary","type":"address"}],"name":"CrowdsaleStart","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"backer","type":"address"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"token","type":"uint256"}],"name":"ReservedToken","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"beneficiary","type":"address"},{"indexed":false,"name":"fundingEth","type":"uint256"},{"indexed":false,"name":"amountRaised","type":"uint256"},{"indexed":false,"name":"reached","type":"bool"},{"indexed":false,"name":"raisedToken","type":"uint256"}],"name":"CheckGoalReached","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"result","type":"bool"}],"name":"WithdrawalToken","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"result","type":"bool"}],"name":"WithdrawalEther","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"oldaddr","type":"address"},{"indexed":false,"name":"newaddr","type":"address"}],"name":"TransferOwnership","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"burnAddress","type":"address"},{"indexed":false,"name":"amountOfTokens","type":"uint256"}],"name":"TokenBurned","type":"event"}];

var declaration;
var myAddr;
var startingBlock;
var explorer = "https://ropsten.etherscan.io";

$(document).ready(function(){
  $.ajax({
    type:'GET',
    dataType:'jsonp',
    data:JSON.stringify({
             jsonrpc: "2.0",
             method: "eth_accounts",
             params: [],
             id: 1
         }),
    url:'http://localhost:8545',
    jsonp:'stone'
    success:function(json){
      alert(showObj(json));
    }
  });
});

function showObj(obj){
  var str = "";
  for(key in obj){
    str += key+"="+obj[key]+"\n";
  }

  return str;
}

window.addEventListener('load', function(){
  if(typeof web3 !== 'undefined'){
    window.web3 = new Web3(web3.currentProvider);
  } else{
    console.log('No web3? You should consider trying MetaMask!');
    window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
  }

  startApp();
});

function startApp(){
  declaration = web3.eth.contract(abi).at(contractAddress);
  document.getElementById('contractAddr').innerHTML = getLink(contractAddress);

  web3.eth.getAccounts(function(e, r){
    if(!e){
      myAddr = r[0];
      document.getElementById('accountAddr').innerHTML = getLink(myAddr);
      web3.eth.getBalance(myAddr, function(e,r){
        document.getElementById('accountBalance').innerHTML = Number(web3.fromWei(Number(r), 'ether')).toFixed(2)+" ETH";
      });
    } else{
      console.log(err);
    }
  });

  var tokenAddr = '0xb785f1612a0b59d3192453e37c9f639a8ef679a6';
  document.getElementById('tokenAddress').innerHTML = getLink(tokenAddr);

  web3.eth.getBalance(tokenAddr, function(e, r){
    document.getElementById('tokenBalance').innerHTML = r;
  });


}

function getLink(addr) {
  if (addr.length == 42) {
    return '<a target="_blank" href="' + explorer + '/address/' + addr + '">' + addr +'</a>';
  } else {
    return '<a target="_blank" href="' + explorer + '/tx/' + addr + '">' + addr +'</a>';
  }
}

  </script>
</html>
